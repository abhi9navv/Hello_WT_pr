<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS | User Auth & Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font and smooth transitions */
        :root {
            --primary-blue: #1c7ed6;
            --sidebar-bg: #2f3640; /* Darker background for sidebar */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #2c3e50; /* Darker blue/gray background for login screen */
            margin: 0;
            padding: 0;
            height: 100vh;
        }
        /* Styles for the Auth Card (login/registration) */
        .form-input {
            transition: all 0.3s ease;
            @apply w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm;
        }
        .main-button {
            transition: background-color 0.3s ease, transform 0.1s ease;
            background-color: var(--primary-blue);
            @apply w-full text-white font-bold py-3 rounded-lg hover:bg-blue-700 active:scale-[0.99] shadow-md;
        }
        .text-link {
            @apply text-sm text-blue-600 hover:text-blue-800 transition duration-150 cursor-pointer;
        }

        /* Styles for the Dashboard Sidebar Navigation */
        .sidebar-link {
            @apply flex items-center px-4 py-3 text-sm font-medium transition duration-150 hover:bg-gray-700/50 cursor-pointer text-gray-400 hover:text-white;
        }
        .sidebar-link.active {
            @apply bg-blue-700/70 text-white border-l-4 border-blue-400;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <!-- ---------------------------------------------------- -->
    <!-- 1. AUTHENTICATION INTERFACE (Login/Registration) -->
    <!-- ---------------------------------------------------- -->
    <div id="auth-card" class="bg-white p-8 sm:p-10 rounded-xl shadow-2xl w-full max-w-sm md:max-w-md transition-all duration-500">

        <!-- Header -->
        <header class="mb-6 pb-4 border-b">
            <h1 id="form-header" class="text-xl font-semibold text-gray-700 text-center">LMS || User Registration</h1>
        </header>

        <!-- Dynamic Form Container -->
        <div id="form-container">
            <!-- Registration Form -->
            <form id="registration-form" onsubmit="handleRegistration(event)" class="space-y-4">
                <input type="text" id="reg-fullName" placeholder="Full Name" required class="form-input">
                <input type="email" id="reg-email" placeholder="Email" required class="form-input">
                <input type="tel" id="reg-mobile" placeholder="Mobile Number (e.g., 555-123-4567)" class="form-input">
                <input type="password" id="reg-password" placeholder="Password" required class="form-input">
                
                <p id="reg-message" class="text-sm text-center text-red-500"></p>

                <button type="submit" class="main-button mt-6">Register</button>

                <!-- Links -->
                <div class="text-center pt-4 space-y-2">
                    <p class="text-link" onclick="toggleForm('login')">Login Page</p>
                    <p class="text-link">Forgot Password?</p>
                </div>
            </form>

            <!-- Login Form (Hidden by default) -->
            <form id="login-form" onsubmit="handleLogin(event)" class="space-y-4 hidden">
                <input type="email" id="log-email" placeholder="Email" required class="form-input">
                <input type="password" id="log-password" placeholder="Password" required class="form-input">
                
                <p id="log-message" class="text-sm text-center text-red-500"></p>

                <button type="submit" class="main-button mt-6">Login</button>

                <!-- Links -->
                <div class="text-center pt-4 space-y-2">
                    <p class="text-link" onclick="toggleForm('register')">Register Page</p>
                    <p class="text-link">Forgot Password?</p>
                </div>
            </form>
        </div>
    </div>

    <!-- ---------------------------------------------------- -->
    <!-- 2. DASHBOARD INTERFACE (Appears after login) -->
    <!-- ---------------------------------------------------- -->
    <div id="dashboard-layout" class="hidden fixed inset-0 flex bg-gray-100">
        
        <!-- Sidebar -->
        <div class="w-16 md:w-64 bg-[var(--sidebar-bg)] text-white flex flex-col transition-all duration-300">
            <div class="p-4 flex items-center h-16 border-b border-gray-700">
                <h2 class="text-xl font-bold whitespace-nowrap hidden md:block">Laundry Managment System</h2>
                <!-- Hamburger Icon (Simple SVG) -->
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 md:hidden cursor-pointer" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </div>
            
            <nav class="flex-grow mt-4 space-y-2">
                <!-- Dashboard Link -->
                <div id="nav-dashboard" class="sidebar-link active" data-view="dashboard" onclick="showView('dashboard', this)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2.586a1 1 0 011-.914h2a1 1 0 011 .914V17a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293-.293a1 1 0 00-1.414-1.414l-7-7z"/></svg>
                    <span class="hidden md:block">Dashboard</span>
                </div>
                <!-- Laundry Request Link -->
                <div id="nav-request" class="sidebar-link group" data-view="request" onclick="showView('request', this)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 004 15h16a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zm0 14a2 2 0 110-4 2 2 0 010 4z"/></svg>
                    <span class="hidden md:block">Laundry Request</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-auto hidden md:block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                </div>
                <!-- Request Status Link -->
                <div id="nav-status" class="sidebar-link group" data-view="status" onclick="showView('status', this)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"/></svg>
                    <span class="hidden md:block">Request Status</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-auto hidden md:block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                </div>
            </nav>
            
            <div class="p-4 mt-auto">
                <button onclick="logout()" class="w-full text-red-400 hover:text-red-300 text-sm py-2 rounded transition hidden md:block">
                    Logout
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-grow flex flex-col">
            <!-- Header (Top Bar) -->
            <header class="bg-white shadow-sm h-16 flex items-center justify-between px-4 sm:px-6">
                <h1 class="text-lg font-semibold text-gray-700">Laundry Managment System</h1>
                <!-- Simple user profile / settings mock -->
                <div class="flex items-center space-x-3">
                    <span class="text-sm text-gray-500 hidden sm:block">Welcome, User!</span>
                    <div class="w-8 h-8 bg-blue-200 rounded-full flex items-center justify-center text-blue-800 font-bold text-sm">U</div>
                </div>
            </header>
            
            <!-- Main Content Section -->
            <main class="flex-grow p-4 sm:p-6 bg-gray-100 overflow-y-auto">
                
                <!-- Breadcrumbs -->
                <nav class="text-sm mb-6 text-gray-500">
                    <span id="breadcrumb-main" class="hover:text-gray-700 cursor-pointer" onclick="showView('dashboard')">Dashboard</span> / <span id="breadcrumb-sub" class="text-gray-900 font-medium">Overview</span>
                </nav>

                <!-- CONTENT VIEWS CONTAINER -->
                <div id="content-views">

                    <!-- 2a. DASHBOARD VIEW -->
                    <div id="view-dashboard" class="view-content">
                        <!-- Status Cards Grid -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                            
                            <!-- Card 1: New Request (Yellow) -->
                            <div class="relative bg-yellow-400 text-white rounded-lg shadow-lg overflow-hidden h-32 flex items-center p-4">
                                <div class="flex flex-col z-10">
                                    <span class="text-3xl font-bold">0 New Request</span>
                                    <button class="text-sm font-semibold bg-white/30 hover:bg-white/50 px-3 py-1 rounded-full mt-2 transition">View Details</button>
                                </div>
                                <!-- Mock Cart Icon SVG in background -->
                                <div class="absolute right-0 top-0 opacity-20 transform scale-[3] translate-x-1/4 translate-y-1/4">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="white" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.44c-.16.27-.25.57-.25.88 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.49c.71 0 1.36-.34 1.76-.84l3.13-5.26c.27-.47.16-1.09-.32-1.36-.47-.27-1.09-.16-1.36.32L21 4H5.21L4.27 2H1zm18 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                                </div>
                            </div>
                            
                            <!-- Card 2: Accept (Blue) -->
                            <div class="relative bg-blue-500 text-white rounded-lg shadow-lg overflow-hidden h-32 flex items-center p-4">
                                <div class="flex flex-col z-10">
                                    <span class="text-3xl font-bold">0 Accept!</span>
                                    <button class="text-sm font-semibold bg-white/30 hover:bg-white/50 px-3 py-1 rounded-full mt-2 transition">View Details</button>
                                </div>
                                <div class="absolute right-0 top-0 opacity-20 transform scale-[3] translate-x-1/4 translate-y-1/4">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="white" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.44c-.16.27-.25.57-.25.88 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.49c.71 0 1.36-.34 1.76-.84l3.13-5.26c.27-.47.16-1.09-.32-1.36-.47-.27-1.09-.16-1.36.32L21 4H5.21L4.27 2H1zm18 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                                </div>
                            </div>

                            <!-- Card 3: Inprocess (Green) -->
                            <div class="relative bg-green-500 text-white rounded-lg shadow-lg overflow-hidden h-32 flex items-center p-4">
                                <div class="flex flex-col z-10">
                                    <span class="text-3xl font-bold">0 Inprocess!</span>
                                    <button class="text-sm font-semibold bg-white/30 hover:bg-white/50 px-3 py-1 rounded-full mt-2 transition">View Details</button>
                                </div>
                                <div class="absolute right-0 top-0 opacity-20 transform scale-[3] translate-x-1/4 translate-y-1/4">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="white" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.44c-.16.27-.25.57-.25.88 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.49c.71 0 1.36-.34 1.76-.84l3.13-5.26c.27-.47.16-1.09-.32-1.36-.47-.27-1.09-.16-1.36.32L21 4H5.21L4.27 2H1zm18 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                                </div>
                            </div>

                            <!-- Card 4: Finish (Red) -->
                            <div class="relative bg-red-500 text-white rounded-lg shadow-lg overflow-hidden h-32 flex items-center p-4">
                                <div class="flex flex-col z-10">
                                    <span class="text-3xl font-bold">1 Finish!</span>
                                    <button class="text-sm font-semibold bg-white/30 hover:bg-white/50 px-3 py-1 rounded-full mt-2 transition">View Details</button>
                                </div>
                                <div class="absolute right-0 top-0 opacity-20 transform scale-[3] translate-x-1/4 translate-y-1/4">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="white" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.44c-.16.27-.25.57-.25.88 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.49c.71 0 1.36-.34 1.76-.84l3.13-5.26c.27-.47.16-1.09-.32-1.36-.47-.27-1.09-.16-1.36.32L21 4H5.21L4.27 2H1zm18 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Laundry Price Table -->
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h2 class="text-xl font-bold text-gray-700 mb-4 text-center">Laundry Price (Per Unit)</h2>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900 w-1/2">Top Wear Laundry Price</td>
                                            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700 w-1/2">12</td>
                                        </tr>
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900">Bottom Wear Laundry Price</td>
                                            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700">22</td>
                                        </tr>
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900">Woolen Cloth Laundry Price</td>
                                            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700">20</td>
                                        </tr>
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900">Other Price</td>
                                            <td class="px-6 py-3 text-sm text-gray-700">Other Price depend upon cloth variety(other than above three category)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <p class="text-center text-xs text-gray-500 mt-6">Copyright Â© Laundry Managment System 2019</p>
                        </div>
                    </div> <!-- End view-dashboard -->

                    <!-- 2b. LAUNDRY REQUEST FORM VIEW -->
                    <div id="view-request" class="view-content hidden">
                        <div class="bg-white rounded-lg shadow-md p-6 max-w-3xl mx-auto">
                            <h2 class="text-2xl font-bold text-gray-700 mb-6">Submit New Laundry Request</h2>
                            
                            <form id="laundry-request-form" onsubmit="handleRequestSubmission(event)" class="space-y-6">
                                
                                <!-- Pick up / Drop Date -->
                                <div>
                                    <label for="pickup-date" class="block text-sm font-medium text-gray-700 mb-1">Pick up / Drop Date</label>
                                    <input type="date" id="pickup-date" required class="form-input" placeholder="mm/dd/yyyy">
                                </div>

                                <!-- Topwear -->
                                <div>
                                    <label for="topwear" class="block text-sm font-medium text-gray-700 mb-1">Topwear (T-Shirt, Top, Shirt) - Enter Quantity</label>
                                    <input type="number" id="topwear" min="0" value="0" class="form-input" placeholder="0">
                                </div>

                                <!-- Bottomwear -->
                                <div>
                                    <label for="bottomwear" class="block text-sm font-medium text-gray-700 mb-1">Bottomwear (Lower, Jeans, Leggins) - Enter Quantity</label>
                                    <input type="number" id="bottomwear" min="0" value="0" class="form-input" placeholder="0">
                                </div>
                                
                                <!-- Woolen Cloth -->
                                <div>
                                    <label for="woolen" class="block text-sm font-medium text-gray-700 mb-1">Woolen Cloth - Enter Quantity</label>
                                    <input type="number" id="woolen" min="0" value="0" class="form-input" placeholder="0">
                                </div>

                                <!-- Others -->
                                <div>
                                    <label for="others" class="block text-sm font-medium text-gray-700 mb-1">Others - Enter Quantity</label>
                                    <input type="number" id="others" min="0" value="0" class="form-input" placeholder="0">
                                </div>

                                <!-- Select Service type -->
                                <div>
                                    <label for="service-type" class="block text-sm font-medium text-gray-700 mb-1">Select Service type</label>
                                    <select id="service-type" required class="form-input appearance-none">
                                        <option value="" disabled selected>Select a service</option>
                                        <option value="wash_fold">Wash & Fold</option>
                                        <option value="wash_iron">Wash & Iron</option>
                                        <option value="dry_clean">Dry Cleaning</option>
                                    </select>
                                </div>

                                <!-- Contact Person -->
                                <div>
                                    <label for="contact-person" class="block text-sm font-medium text-gray-700 mb-1">Contact Person</label>
                                    <input type="text" id="contact-person" required class="form-input" placeholder="Enter contact name">
                                </div>

                                <!-- Description (if any) -->
                                <div>
                                    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description (if any)</label>
                                    <textarea id="description" rows="3" class="form-input resize-none" placeholder="Special instructions, stains, etc."></textarea>
                                </div>

                                <button type="submit" class="main-button mt-6">Submit Request</button>
                                <p id="request-message" class="text-sm text-center pt-2"></p>
                            </form>
                        </div>
                    </div> <!-- End view-request -->

                    <!-- 2c. REQUEST STATUS VIEW (Placeholder) -->
                    <div id="view-status" class="view-content hidden">
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h2 class="text-2xl font-bold text-gray-700 mb-4">Your Request Status</h2>
                            <p class="text-gray-600">This section will show a table of your submitted laundry requests and their current status (New, Accepted, In Process, Finished).</p>
                        </div>
                    </div> <!-- End view-status -->

                </div>
            </main>
        </div>
    </div>

    <!-- Custom Modal/Message Box (Replaces alert()) -->
    <div id="message-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm">
            <h3 id="modal-title" class="text-lg font-bold mb-2 text-gray-800">Status</h3>
            <p id="modal-content" class="text-gray-600 mb-4"></p>
            <button onclick="closeModal()" class="main-button !w-auto px-4 py-2 ml-auto block">Close</button>
        </div>
    </div>

    <script>
        const API_KEY = ""; 

        // --- UTILITY FUNCTIONS ---

        /** Shows a custom modal message instead of using alert() */
        function showMessage(title, content, isError = false) {
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');

            modalTitle.textContent = title;
            modalContent.textContent = content;

            if (isError) {
                modalTitle.classList.remove('text-gray-800');
                modalTitle.classList.add('text-red-600');
            } else {
                modalTitle.classList.remove('text-red-600');
                modalTitle.classList.add('text-gray-800');
            }
            document.getElementById('message-modal').classList.remove('hidden');
        }

        /** Closes the custom modal */
        function closeModal() {
            document.getElementById('message-modal').classList.add('hidden');
        }

        /** Toggles between the registration and login forms */
        function toggleForm(target) {
            const regForm = document.getElementById('registration-form');
            const logForm = document.getElementById('login-form');
            const header = document.getElementById('form-header');
            
            // Clear messages
            document.getElementById('reg-message').textContent = '';
            document.getElementById('log-message').textContent = '';

            if (target === 'login') {
                regForm.classList.add('hidden');
                logForm.classList.remove('hidden');
                header.textContent = 'LMS || User Login';
            } else {
                logForm.classList.add('hidden');
                regForm.classList.remove('hidden');
                header.textContent = 'LMS || User Registration';
            }
        }

        /** Switches the content view inside the dashboard */
        function showView(viewName, clickedElement) {
            const views = document.querySelectorAll('.view-content');
            const navLinks = document.querySelectorAll('.sidebar-link');
            const breadcrumbSub = document.getElementById('breadcrumb-sub');

            // 1. Hide all views
            views.forEach(view => view.classList.add('hidden'));

            // 2. Show the selected view
            const targetView = document.getElementById(`view-${viewName}`);
            if (targetView) {
                targetView.classList.remove('hidden');
            } else {
                console.error(`View ${viewName} not found.`);
                return;
            }

            // 3. Update active link state
            navLinks.forEach(link => link.classList.remove('active'));
            if (clickedElement) {
                clickedElement.classList.add('active');
            } else {
                // If called directly (like from the breadcrumb), find the element manually
                document.getElementById(`nav-${viewName}`).classList.add('active');
            }

            // 4. Update Breadcrumbs
            if (viewName === 'dashboard') {
                breadcrumbSub.textContent = 'Overview';
            } else if (viewName === 'request') {
                breadcrumbSub.textContent = 'Laundry Request';
            } else if (viewName === 'status') {
                breadcrumbSub.textContent = 'Request Status';
            }
        }


        /** Simulates successful login and switches to the dashboard view */
        function redirectToDashboard() {
            // 1. Hide the login/registration card
            document.getElementById('auth-card').classList.add('hidden');
            
            // 2. Change the body styling to fit the full-screen dashboard layout
            document.body.classList.remove('flex', 'items-center', 'justify-center', 'min-h-screen');
            document.body.style.backgroundColor = '#f3f4f6'; // Light gray background for dashboard
            
            // 3. Display the dashboard layout and set default view to dashboard
            document.getElementById('dashboard-layout').classList.remove('hidden');
            showView('dashboard', document.getElementById('nav-dashboard'));
        }

        /** Simulates logout and switches back to the login view */
        function logout() {
             document.getElementById('dashboard-layout').classList.add('hidden');
            
            // Restore center styling and background for the auth card
            document.body.classList.add('flex', 'items-center', 'justify-center', 'min-h-screen');
            document.body.style.backgroundColor = '#2c3e50'; 

            document.getElementById('auth-card').classList.remove('hidden');
            toggleForm('login'); // Ensure it goes back to the login screen
        }

        // --- FORM HANDLERS (PHP simulation) ---
        
        // Helper function for simulating fetch with retries (best practice)
        async function fetchDataWithRetry(url, payload) {
            const MAX_RETRIES = 3;
            for (let i = 0; i < MAX_RETRIES; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i < MAX_RETRIES - 1) {
                        // Exponential backoff
                        const delay = Math.pow(2, i) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        throw new Error('All connection attempts failed. Please try again later.');
                    }
                }
            }
        }


        /** Handles the Registration form submission */
        async function handleRegistration(event) {
            event.preventDefault();
            const messageEl = document.getElementById('reg-message');
            messageEl.textContent = 'Processing...';

            const fullName = document.getElementById('reg-fullName').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const mobile = document.getElementById('reg-mobile').value.trim();
            const password = document.getElementById('reg-password').value;

            const payload = { fullName, email, mobile, password };

            // Simulate server-side processing
            try {
                await new Promise(resolve => setTimeout(resolve, 1500)); 
                const result = { success: true, message: "Registration successful! You can now log in." };
                
                messageEl.textContent = '';
                if (result.success) {
                    showMessage("Success!", result.message);
                    setTimeout(() => toggleForm('login'), 2000); 
                } else {
                    messageEl.textContent = result.message || "Registration failed. Please check your details.";
                }

            } catch (error) {
                console.error("Registration error:", error);
                showMessage("Registration Failed", `A server error occurred: ${error.message}`, true);
            }
        }

        /** Handles the Login form submission */
        async function handleLogin(event) {
            event.preventDefault();
            const messageEl = document.getElementById('log-message');
            messageEl.textContent = 'Processing...';

            const email = document.getElementById('log-email').value.trim();
            const password = document.getElementById('log-password').value;

            // Simulate server-side processing
            try {
                await new Promise(resolve => setTimeout(resolve, 1500)); 
                
                let result;
                // SIMULATING successful login if email is 'test@example.com' and password is 'password123'
                if (email === 'test@example.com' && password === 'password123') {
                    result = { success: true, message: "Login successful! Redirecting..." };
                } else {
                    result = { success: false, message: "Invalid email or password." };
                }
                
                messageEl.textContent = '';
                if (result.success) {
                    messageEl.textContent = result.message;
                    // --- SUCCESS ACTION: SHOW DASHBOARD ---
                    setTimeout(() => {
                        closeModal();
                        redirectToDashboard(); // Switches to the main application interface
                    }, 1000);
                    // -------------------------------------
                } else {
                    messageEl.textContent = result.message || "Login failed.";
                }

            } catch (error) {
                console.error("Login error:", error);
                showMessage("Login Failed", `A server error occurred: ${error.message}`, true);
            }
        }

        /** Handles the Laundry Request form submission */
        async function handleRequestSubmission(event) {
            event.preventDefault();
            const messageEl = document.getElementById('request-message');
            messageEl.textContent = 'Submitting request...';
            messageEl.classList.remove('text-red-500', 'text-green-500');
            messageEl.classList.add('text-gray-600');

            const formData = {
                date: document.getElementById('pickup-date').value,
                topwear: parseInt(document.getElementById('topwear').value),
                bottomwear: parseInt(document.getElementById('bottomwear').value),
                woolen: parseInt(document.getElementById('woolen').value),
                others: parseInt(document.getElementById('others').value),
                serviceType: document.getElementById('service-type').value,
                contactPerson: document.getElementById('contact-person').value,
                description: document.getElementById('description').value
            };

            if ((formData.topwear + formData.bottomwear + formData.woolen + formData.others) === 0) {
                 messageEl.textContent = 'Please enter at least one item quantity.';
                 messageEl.classList.remove('text-gray-600');
                 messageEl.classList.add('text-red-500');
                 return;
            }

            // Simulate server-side processing
            try {
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const result = { success: true, requestID: 'LMS-0002', message: "Your laundry request has been successfully submitted!" };

                if (result.success) {
                    messageEl.textContent = `Success! Request ID ${result.requestID} submitted.`;
                    messageEl.classList.remove('text-gray-600');
                    messageEl.classList.add('text-green-500');
                    showMessage("Request Submitted", `Your request ID is ${result.requestID}. We will notify you when it's accepted!`);
                    
                    // Optional: Reset form fields after success
                    document.getElementById('laundry-request-form').reset();
                    
                    // Automatically switch to status view (if implemented)
                    // setTimeout(() => showView('status'), 3000); 

                } else {
                    messageEl.textContent = result.message || "Submission failed. Please check the form.";
                    messageEl.classList.remove('text-gray-600');
                    messageEl.classList.add('text-red-500');
                }

            } catch (error) {
                console.error("Request submission error:", error);
                showMessage("Submission Error", `Could not submit request due to a server error: ${error.message}`, true);
            }
        }
    </script>
</body>
</html>
